<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç ”ç©¶è€…æ¤œç´¢API - ãƒ†ã‚¹ãƒˆ</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .status.success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .status.warning {
            background-color: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #0056b3;
        }
        .output {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 10px;
            margin: 10px 0;
            white-space: pre-wrap;
            font-family: monospace;
            max-height: 300px;
            overflow-y: auto;
        }
        input[type="text"] {
            width: 300px;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”¬ ç ”ç©¶è€…æ¤œç´¢API ãƒ†ã‚¹ãƒˆãƒ„ãƒ¼ãƒ«</h1>
        
        <div class="status warning">
            <strong>âš ï¸ æ³¨æ„:</strong> APIã‚µãƒ¼ãƒãƒ¼ãŒèµ·å‹•ã—ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ãã ã•ã„
        </div>

        <h2>ğŸ“Š ã‚µãƒ¼ãƒãƒ¼çŠ¶æ…‹ç¢ºèª</h2>
        <div>
            <label>API Base URL:</label>
            <input type="text" id="apiBaseUrl" value="http://localhost:8000" placeholder="http://localhost:8000">
            <button onclick="updateApiUrl()">URLæ›´æ–°</button>
        </div>
        
        <div>
            <button onclick="testConnection()">ğŸ”— æ¥ç¶šãƒ†ã‚¹ãƒˆ</button>
            <button onclick="testHealth()">â¤ï¸ ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯</button>
            <button onclick="testUniversities()">ğŸ« å¤§å­¦ãƒªã‚¹ãƒˆ</button>
            <button onclick="testSearch()">ğŸ” æ¤œç´¢ãƒ†ã‚¹ãƒˆ</button>
        </div>

        <div id="status" class="status"></div>
        <div id="output" class="output"></div>

        <h2>ğŸ” ç ”ç©¶è€…æ¤œç´¢</h2>
        <div>
            <input type="text" id="searchQuery" placeholder="æ¤œç´¢ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰" value="äººå·¥çŸ¥èƒ½">
            <select id="searchMethod">
                <option value="keyword">ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œç´¢</option>
                <option value="semantic">ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯æ¤œç´¢</option>
            </select>
            <button onclick="performSearch()">æ¤œç´¢å®Ÿè¡Œ</button>
        </div>

        <div id="searchResults" class="output"></div>
    </div>

    <script>
        let apiBaseUrl = 'http://localhost:8000';

        function updateApiUrl() {
            apiBaseUrl = document.getElementById('apiBaseUrl').value;
            updateStatus('info', `API URLæ›´æ–°: ${apiBaseUrl}`);
        }

        function updateStatus(type, message) {
            const statusDiv = document.getElementById('status');
            statusDiv.className = `status ${type}`;
            statusDiv.innerHTML = message;
        }

        function updateOutput(content) {
            document.getElementById('output').textContent = content;
        }

        async function testConnection() {
            updateStatus('warning', 'æ¥ç¶šãƒ†ã‚¹ãƒˆä¸­...');
            try {
                const response = await fetch(`${apiBaseUrl}/`);
                if (response.ok) {
                    const data = await response.json();
                    updateStatus('success', 'âœ… æ¥ç¶šæˆåŠŸ');
                    updateOutput(JSON.stringify(data, null, 2));
                } else {
                    updateStatus('error', `âŒ æ¥ç¶šå¤±æ•—: HTTP ${response.status}`);
                    updateOutput(`Status: ${response.status} ${response.statusText}`);
                }
            } catch (error) {
                updateStatus('error', `âŒ æ¥ç¶šã‚¨ãƒ©ãƒ¼: ${error.message}`);
                updateOutput(`Error: ${error.toString()}\n\nè€ƒãˆã‚‰ã‚Œã‚‹åŸå› :\n1. ã‚µãƒ¼ãƒãƒ¼ãŒèµ·å‹•ã—ã¦ã„ãªã„\n2. ãƒãƒ¼ãƒˆç•ªå·ãŒé•ã†\n3. CORSè¨­å®šã®å•é¡Œ`);
            }
        }

        async function testHealth() {
            updateStatus('warning', 'ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ä¸­...');
            try {
                const response = await fetch(`${apiBaseUrl}/health`);
                if (response.ok) {
                    const data = await response.json();
                    updateStatus('success', 'âœ… ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯æˆåŠŸ');
                    updateOutput(JSON.stringify(data, null, 2));
                } else {
                    updateStatus('error', `âŒ ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯å¤±æ•—: HTTP ${response.status}`);
                    updateOutput(`Status: ${response.status} ${response.statusText}`);
                }
            } catch (error) {
                updateStatus('error', `âŒ ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã‚¨ãƒ©ãƒ¼: ${error.message}`);
                updateOutput(`Error: ${error.toString()}`);
            }
        }

        async function testUniversities() {
            updateStatus('warning', 'å¤§å­¦ãƒªã‚¹ãƒˆå–å¾—ä¸­...');
            try {
                const response = await fetch(`${apiBaseUrl}/api/universities`);
                if (response.ok) {
                    const data = await response.json();
                    updateStatus('success', `âœ… å¤§å­¦ãƒªã‚¹ãƒˆå–å¾—æˆåŠŸ: ${data.total_universities}æ ¡`);
                    updateOutput(JSON.stringify(data, null, 2));
                } else {
                    updateStatus('error', `âŒ å¤§å­¦ãƒªã‚¹ãƒˆå–å¾—å¤±æ•—: HTTP ${response.status}`);
                    updateOutput(`Status: ${response.status} ${response.statusText}`);
                }
            } catch (error) {
                updateStatus('error', `âŒ å¤§å­¦ãƒªã‚¹ãƒˆå–å¾—ã‚¨ãƒ©ãƒ¼: ${error.message}`);
                updateOutput(`Error: ${error.toString()}`);
            }
        }

        async function testSearch() {
            updateStatus('warning', 'æ¤œç´¢ãƒ†ã‚¹ãƒˆä¸­...');
            try {
                const response = await fetch(`${apiBaseUrl}/api/search`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        query: 'æ©Ÿæ¢°å­¦ç¿’',
                        method: 'keyword',
                        max_results: 2
                    })
                });
                if (response.ok) {
                    const data = await response.json();
                    updateStatus('success', `âœ… æ¤œç´¢ãƒ†ã‚¹ãƒˆæˆåŠŸ: ${data.total}ä»¶`);
                    updateOutput(JSON.stringify(data, null, 2));
                } else {
                    updateStatus('error', `âŒ æ¤œç´¢ãƒ†ã‚¹ãƒˆå¤±æ•—: HTTP ${response.status}`);
                    updateOutput(`Status: ${response.status} ${response.statusText}`);
                }
            } catch (error) {
                updateStatus('error', `âŒ æ¤œç´¢ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`);
                updateOutput(`Error: ${error.toString()}`);
            }
        }

        async function performSearch() {
            const query = document.getElementById('searchQuery').value;
            const method = document.getElementById('searchMethod').value;
            
            if (!query.trim()) {
                updateStatus('error', 'âŒ æ¤œç´¢ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }

            updateStatus('warning', `æ¤œç´¢ä¸­: "${query}" (${method})`);
            
            try {
                const response = await fetch(`${apiBaseUrl}/api/search`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        query: query,
                        method: method,
                        max_results: 5
                    })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    updateStatus('success', `âœ… æ¤œç´¢å®Œäº†: ${data.total}ä»¶ (${data.execution_time.toFixed(2)}ç§’)`);
                    
                    // æ¤œç´¢çµæœã‚’æ•´å½¢ã—ã¦è¡¨ç¤º
                    let resultText = `æ¤œç´¢çµæœ: ${data.total}ä»¶\n`;
                    resultText += `å®Ÿè¡Œæ™‚é–“: ${data.execution_time.toFixed(2)}ç§’\n`;
                    resultText += `æ¤œç´¢æ–¹æ³•: ${data.method}\n\n`;
                    
                    if (data.results && data.results.length > 0) {
                        data.results.forEach((result, index) => {
                            resultText += `${index + 1}. ${result.name_ja || 'åå‰ä¸æ˜'}\n`;
                            resultText += `   æ‰€å±: ${result.main_affiliation_name_ja || 'æ‰€å±ä¸æ˜'}\n`;
                            resultText += `   ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰: ${result.research_keywords_ja || 'ãªã—'}\n`;
                            if (result.relevance_score) {
                                resultText += `   é–¢é€£åº¦: ${result.relevance_score}\n`;
                            }
                            if (result.distance) {
                                resultText += `   è·é›¢: ${result.distance.toFixed(4)}\n`;
                            }
                            resultText += '\n';
                        });
                    } else {
                        resultText += 'æ¤œç´¢çµæœãŒã‚ã‚Šã¾ã›ã‚“ã€‚\n';
                    }
                    
                    document.getElementById('searchResults').textContent = resultText;
                } else {
                    updateStatus('error', `âŒ æ¤œç´¢å¤±æ•—: HTTP ${response.status}`);
                    document.getElementById('searchResults').textContent = `Error: ${response.status} ${response.statusText}`;
                }
            } catch (error) {
                updateStatus('error', `âŒ æ¤œç´¢ã‚¨ãƒ©ãƒ¼: ${error.message}`);
                document.getElementById('searchResults').textContent = `Error: ${error.toString()}`;
            }
        }

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«è‡ªå‹•ã§æ¥ç¶šãƒ†ã‚¹ãƒˆ
        window.addEventListener('load', function() {
            setTimeout(testConnection, 1000);
        });
    </script>
</body>
</html>
